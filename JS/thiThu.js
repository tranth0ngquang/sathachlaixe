// Bộ câu hỏi

function getQuestions(topic) {
  if (topic === "A1 - Đề 1")
    return [
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },

      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },

      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },

      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },

      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Trong các khái niệm dưới đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },

      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      // Thêm các câu hỏi khác tương tự như trên
    ];
  else if (topic === "A1 - Đề 2")
    return [
      {
        question:
          "Trong các khái niệm dưới đây đây đây, “dải phân cách” được hiểu như thế nào là đúng?",
        answers: [
          "Là bộ phận của đường để ngăn cách không cho các loại xe vào những nơi không được phép.",
          "Là bộ phận của đường để phân tách phần đường xe chạy và hành lang an toàn giao thông.",
          "Là bộ phận của đường để phân chia mặt đường thành hai chiều xe chạy riêng biệt hoặc để phân chia phần đường của xe cơ giới và xe thô sơ.",
          "Cả 3 đáp án trên.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "“Người điều khiển phương tiện tham gia giao thông đường bộ” gồm những đối tượng nào dưới đây?",
        answers: [
          "Người điều khiển xe cơ giới          , người điều khiển xe thô sơ.",
          "Người điều khiển xe máy chuyên dùng tham gia giao thông đường bộ.",
          "Cả ý 1 và ý 2.",
          "Người đi bộ.",
        ],
        correctAnswer: [2],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
          "Chỉ bị nghiêm cấm nếu gây tai nạn.",
        ],
        correctAnswer: [1],
      },
      {
        question:
          "Hành vi điều khiển xe cơ giới chạy quá tốc độ quy định, giành đường, vượt ẩu có bị nghiêm cấm hay không?",
        answers: [
          "Bị nghiêm cấm tuỳ từng trường hợp.",
          "Không bị nghiêm cấm.",
          "Bị nghiêm cấm.",
        ],
        correctAnswer: [1],
      },
    ];
}

// --------------------  *  --------------------  *  ----------------------

let currentQuestionIndex = 0;
let isQuizSubmitted = false;

document.getElementById("topic-select").addEventListener("change", function () {
  const startButton = document.getElementById("start-quiz");
  startButton.disabled = !this.value;
});

// Số lượng câu cần trả lời đúng và số lượng câu hỏi
let quantity = 21;

// --------------------  *  --------------------  *  ----------------------

// Băng thông tin đề thi + kết quả thi thử
document.getElementById("start-quiz").addEventListener("click", function () {
  // reset bien isQuizSubmitted
  isQuizSubmitted = false;

  const selectedTopic = document.getElementById("topic-select").value;
  let quantityLength = getQuestions(selectedTopic).length;
  const quizContent = document.getElementById("quiz-content");
  const selectionScreen = document.getElementById("selection-screen");
  const infoScreen = document.getElementById("info-screen");

  // info-screen-finish
  const infoScreenFinish = document.getElementById("info-screen-finish");
  if (infoScreenFinish) {
    infoScreenFinish.style.display = "none";
  }
  startCountdown(10);

  document.getElementById("info-name").textContent =
    "Họ và tên: " + document.getElementById("user-name").value;
  document.getElementById("info-test").textContent =
    "Đề tài: " + selectedTopic + " |";
  document.getElementById("info-day").textContent =
    "Ngày: " + new Date().toLocaleDateString();
  document.getElementById("info-status").textContent = "Trạng thái: Đang thi  ";

  document.getElementById(
    "info-quantity"
  ).textContent = `Bạn cần trả lời đúng ${quantity}/${quantityLength} câu hỏi`;

  // Bảng thi thử có id: info-screen
  if (selectedTopic) {
    selectionScreen.style.display = "block";
    quizContent.style.display = "block";
    infoScreen.style.display = "block";
    const questions = getQuestions(selectedTopic);
    displayQuestions(questions);
    showQuestionDetails(0, questions);
  }
});

// --------------------  *  --------------------  *  ----------------------

// const submmitHandle = (questions) => {
//   submitButton.addEventListener("click", function () {
//     isQuizSubmitted = true;
//     const confirmation = confirm("Bạn có chắc chắn muốn nộp bài không?");

//     // Nếu nhấn ok thì làm các cái sau
//     if (confirmation) {
//       const { correctCount, incorrectCount, unselectedCount } =
//         checkAnswers(questions);

//       // Cập nhật thông tin trạng thái thi
//       document.getElementById("info-status").textContent = "Trạng thái: Đã thi";

//       // code for modal
//       // Prepare the result content for Modal
//       const resultContent = `
//           <hr>
//           <h5 class="pt-1">Kết quả thi:</h5>
//           <p style="color: black; font-weight: 700;">Số câu đúng: ${correctCount} câu.</p>
//           <p style="color: black; font-weight: 700;">Số câu sai: ${incorrectCount} câu.</p>
//           <p style="color: black; font-weight: 700;">Số câu chưa chọn: ${unselectedCount} câu.</p>
//           <p>Bạn cần trả lời đúng ${quantity} câu hỏi thì đậu.</p>
//           <p style="color: white; background-color: ${
//             correctCount >= quantity ? "green" : "red"
//           }; border-radius: 8px; padding: 10px; text-align: center;"> ${
//         correctCount < quantity ? "Bạn đã trượt." : "Bạn đã đậu."
//       }
//           </p>
//           <hr>
//       `;
//       // Insert result content into modal body
//       document.getElementById("resultModalBody").innerHTML = resultContent;
//       // Display the modal
//       $("#resultModal").modal("show");

//       // code for info-screen-finish
//       const infoScreenFinish = document.getElementById("info-screen-finish");
//       infoScreenFinish.style.display = "block";
//       while (infoScreenFinish.firstChild) {
//         infoScreenFinish.removeChild(infoScreenFinish.firstChild);
//       }
//       const resultDiv = document.createElement("div");
//       resultDiv.innerHTML = `
//         <hr>
//         <h5 class="pt-1">Kết quả thi:</h5>
//         <p style="color: black; font-weight: 700;">Số câu đúng: ${correctCount} câu.</p>
//         <p style="color: black; font-weight: 700;">Số câu sai: ${incorrectCount} câu.</p>
//         <p style="color: black; font-weight: 700;">Số câu chưa chọn: ${unselectedCount} câu.</p>
//         <p>Bạn cần trả lời đúng ${quantity} câu hỏi thì đậu.</p>
//         <p style="color: white; background-color: ${
//           correctCount >= quantity ? "green" : "red"
//         };
//         border-radius: 8px; padding: 10px; text-align: center;">
//         ${correctCount < quantity ? "Bạn đã trượt." : "Bạn đã đậu."}
//         </p>
//         <hr>
//         `;
//       infoScreenFinish.appendChild(resultDiv);

//       submitButton.style.display = "none";
//       showQuestionDetails(0, questions);
//       // clear countdown
//       clearInterval(countdownInterval);
//     }
//   });
// };

// Các câu hỏi

function displayQuestions(questions) {
  const questionsContainer = document.getElementById("questions-container");
  const answersContainer = document.getElementById("answers-container");
  questionsContainer.innerHTML = "";
  answersContainer.innerHTML = "";

  // Tạo nút nộp bài khi hiển thị nhánh phải
  const submitButton = document.createElement("button");
  submitButton.id = "submit-button";
  submitButton.classList = "btn btn-danger";
  submitButton.textContent = "KẾT THÚC";
  // submmitHandle(questions);

  submitButton.addEventListener("click", function () {
    isQuizSubmitted = true;
    const confirmation = confirm("Bạn có chắc chắn muốn nộp bài không?");
    if (confirmation) {
      const { correctCount, incorrectCount, unselectedCount } =
        checkAnswers(questions);

      // Prepare the result content
      const resultContent = `
   <hr>
   <h5 class="pt-1">Kết quả thi:</h5>
   <p style="color: black; font-weight: 700;">Số câu đúng: ${correctCount} câu.</p>
   <p style="color: black; font-weight: 700;">Số câu sai: ${incorrectCount} câu.</p>
   <p style="color: black; font-weight: 700;">Số câu chưa chọn: ${unselectedCount} câu.</p>
   <p>Bạn cần trả lời đúng ${quantity} câu hỏi thì đậu.</p>
   <p style="color: white; background-color: ${
     correctCount >= quantity ? "green" : "red"
   };
   border-radius: 8px; padding: 10px; text-align: center;">
   ${correctCount < quantity ? "Bạn đã trượt." : "Bạn đã đậu."}
   </p>
   <hr>
  `;
      // Insert result content into modal body
      document.getElementById("resultModalBody").innerHTML = resultContent;

      // Display the modal
      $("#resultModal").modal("show");

      const infoScreenFinish = document.getElementById("info-screen-finish");
      infoScreenFinish.style.display = "block";
      while (infoScreenFinish.firstChild) {
        infoScreenFinish.removeChild(infoScreenFinish.firstChild);
      }
      const resultDiv = document.createElement("div");
      resultDiv.innerHTML = `
          <hr>
          <h5 class="pt-1">Kết quả thi:</h5>
          <p style="color: black; font-weight: 700;">Số câu đúng: ${correctCount} câu.</p>
          <p style="color: black; font-weight: 700;">Số câu sai: ${incorrectCount} câu.</p>
          <p style="color: black; font-weight: 700;">Số câu chưa chọn: ${unselectedCount} câu.</p>
          <p>Bạn cần trả lời đúng ${quantity} câu hỏi thì đậu.</p>
          <p style="color: white; background-color: ${
            correctCount >= quantity ? "green" : "red"
          };
          border-radius: 8px; padding: 10px; text-align: center;">
          ${correctCount < quantity ? "Bạn đã trượt." : "Bạn đã đậu."}
          </p>
          <hr>
          `;

      infoScreenFinish.appendChild(resultDiv);

      document.getElementById("info-status").textContent = "Trạng thái: Đã thi";
      submitButton.style.display = "none";
      showQuestionDetails(0, questions);

      // clear countdown
      clearInterval(countdownInterval);
    }
  });

  const col1 = document.createElement("div");
  col1.classList.add("col-6");

  const col2 = document.createElement("div");
  col2.classList.add("col-6");

  const rowContainer = document.createElement("div");
  rowContainer.classList.add("row");

  rowContainer.appendChild(col1);
  rowContainer.appendChild(col2);

  answersContainer.appendChild(rowContainer);

  questions.forEach((question, index) => {
    const colDiv = document.createElement("div");

    const questionDiv = document.createElement("div");
    questionDiv.classList.add("question-detail");
    questionDiv.dataset.index = index;
    questionDiv.addEventListener("click", () =>
      showQuestionDetails(index, questions)
    );
    colDiv.appendChild(questionDiv);

    const answerDiv = document.createElement("div");
    answerDiv.classList.add("answer-option");
    answerDiv.dataset.index = index;
    answerDiv.addEventListener("click", (event) => {
      if (isQuizSubmitted) {
        const clickedIndex = Number(event.currentTarget.dataset.index);
        showQuestionDetails(clickedIndex, questions);
      } else {
        currentQuestionIndex = Number(event.currentTarget.dataset.index);
        const allAnswerDivs = document.querySelectorAll(".answer-option");
        allAnswerDivs.forEach((div) => (div.style.backgroundColor = ""));
        const clickedIndex = Number(event.currentTarget.dataset.index);
        showQuestionDetails(clickedIndex, questions);
        event.currentTarget.style.backgroundColor = "#cacaca";
      }
    });

    answerDiv.innerHTML = `
      <strong>C${index + 1} </strong>
      ${question.answers
        .map(
          (answer, answerIndex) => `
            <label style="margin: 0;">
              ${answerIndex + 1}
              <input type="checkbox" name="answer-${index}" value="${
            answerIndex + 1
          }" style="width: 15px; height: 15px; margin: 0 2px 0 0;"
              onclick="selectAnswer(${index}, ${answerIndex})">
            </label>`
        )
        .join("")}
    `;

    colDiv.appendChild(answerDiv);

    if (index < 13) {
      col1.appendChild(colDiv);
    } else {
      col2.appendChild(colDiv);
    }
  });

  answersContainer.appendChild(submitButton);
}

// --------------------  *  --------------------  *  ----------------------

// In câu hỏi ở bên trái
function showQuestionDetails(index, questions) {
  const questionDetails = questions[index];
  const questionsContainer = document.getElementById("questions-container");
  questionsContainer.innerHTML = `
            <div class="question-number">
              <strong>
                Câu ${Number(index + 1)}: ${questionDetails.question}
              </strong>
            </div>

            ${questionDetails.answers
              .map(
                (answer, i) => `
            <div class="answer p-2"
            style="${
              isQuizSubmitted && questionDetails.correctAnswer.includes(i + 1)
                ? "background-color: green; color: white; border-radius: 8px;"
                : ""
            };"
            >${i + 1}. ${answer}
            </div>`
              )
              .join("")}
        `;
}

// --------------------  *  --------------------  *  ----------------------

// Test thử ở clg
function selectAnswer(questionIndex, answerIndex) {
  console.log(
    `Chọn câu trả lời: ${answerIndex + 1} cho câu hỏi: ${questionIndex + 1}`
  );
  showQuestionDetails(questionIndex, getQuestions()); // Update question details with selected answer
}

// --------------------  *  --------------------  *  ----------------------

function checkAnswers(questions) {
  let correctCount = 0;
  let incorrectCount = 0;
  let unselectedCount = 0;
  const answersContainer = document.getElementById("answers-container");
  const answerDivs = answersContainer.querySelectorAll(".answer-option");
  isQuizSubmitted = true;
  questions.forEach((question, index) => {
    const checkboxes = document.querySelectorAll(
      `input[name="answer-${index}"]`
    );
    const selectedAnswers = Array.from(checkboxes)
      .filter((checkbox) => checkbox.checked)
      .map((checkbox) => parseInt(checkbox.value));

    const answerDiv = answerDivs[index];

    if (
      selectedAnswers.length === question.correctAnswer.length &&
      question.correctAnswer.every((answer) => selectedAnswers.includes(answer))
    ) {
      correctCount++;
      answerDiv.style.backgroundColor = "rgb(0, 210, 0)"; // nền câu hỏi xanh: trả lời đúng
    } else if (selectedAnswers.length === 0) {
      unselectedCount++;
      answerDiv.style.backgroundColor = "yellow"; // nền câu hỏi vàng: chưa trả lời
    } else {
      incorrectCount++;
      answerDiv.style.backgroundColor = "red"; // nền câu hỏi đỏ: trả lời sai
    }

    // Highlight correct answers in green
    answerDiv.querySelectorAll("label").forEach((label, labelIndex) => {
      if (question.correctAnswer.includes(labelIndex + 1)) {
        // chỉnh màu text sang xanh nếu đúng
        label.style.borderRadius = "5px";
        label.style.padding = "3px";
        label.style.color = "white";
        label.style.backgroundColor = "green";
      }
    });
  });

  const checkboxes = document.querySelectorAll('input[type="checkbox"]');
  checkboxes.forEach((checkbox) => {
    checkbox.disabled = true;
  });

  // isQuizSubmitted = true

  return { correctCount, incorrectCount, unselectedCount };
}

// --------------------  *  --------------------  *  ----------------------

// Sử dụng phím lên xuống trái phải

document.addEventListener("keydown", function (event) {
  if (isQuizSubmitted) return;
  const selectedTopic = document.getElementById("topic-select").value;
  const questions = getQuestions(selectedTopic);
  const maxIndex = questions.length - 1;
  const allAnswerDivs = document.querySelectorAll(".answer-option");

  // Ngăn chặn hành vi mặc định của phím mũi tên
  if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(event.key)) {
    event.preventDefault();
  }

  switch (event.key) {
    case "ArrowUp":
    case "ArrowLeft":
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestionDetails(currentQuestionIndex, questions);
        allAnswerDivs.forEach((div) => (div.style.backgroundColor = ""));
        allAnswerDivs[currentQuestionIndex].style.backgroundColor = "#cacaca";
      }
      break;
    case "ArrowDown":
    case "ArrowRight":
      if (currentQuestionIndex < maxIndex) {
        currentQuestionIndex++;
        showQuestionDetails(currentQuestionIndex, questions);
        allAnswerDivs.forEach((div) => (div.style.backgroundColor = ""));
        allAnswerDivs[currentQuestionIndex].style.backgroundColor = "#cacaca";
      }
      break;
  }
});

// --------------------  *  --------------------  *  ----------------------

// Sử dụng phím 1 2 3 4

document.addEventListener("keydown", function (event) {
  const key = event.key;
  const validKeys = ["1", "2", "3", "4"];

  if (validKeys.includes(key)) {
    const questionIndex = currentQuestionIndex;
    const answerIndex = parseInt(key) - 1; // subtract 1 because array index starts from 0

    const checkbox = document.querySelector(
      `input[name="answer-${questionIndex}"][value="${answerIndex + 1}"]`
    );

    if (checkbox) {
      checkbox.checked = !checkbox.checked;
    }
  }
});

// --------------------  *  --------------------  *  ----------------------

// Sử dụng phím ESC để nộp bài
window.addEventListener("keydown", function (event) {
  if (event.key === "Escape") {
    const submitButton = document.getElementById("submit-button");
    if (submitButton) {
      submitButton.click();
      isQuizSubmitted = true;
    }
  }
});

// Sử dụng phím Enter để nộp bài
window.addEventListener("keydown", function (event) {
  if (event.key === "Enter") {
    const submitButton = document.getElementById("submit-button");
    if (submitButton) {
      submitButton.click();
    }
  }
});

let countdownInterval;

function startCountdown(duration) {
  let countdownElement = document.getElementById("countdown");
  let remainingTime = duration;

  countdownInterval = setInterval(() => {
    let minutes = Math.floor(remainingTime / 60);
    let seconds = remainingTime % 60;

    countdownElement.textContent = `${minutes}:${
      seconds < 10 ? "0" : ""
    }${seconds}`;

    remainingTime--;

    if (remainingTime < 0) {
      clearInterval(countdownInterval);
      const submitButton = document.getElementById("submit-button");
      if (submitButton) {
        submitButton.click();
      }
    }
  }, 1000);
}
